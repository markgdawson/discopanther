<?php
$errors = '';
$show_thanks = false;

if(empty($_POST['name'])  &&
   empty($_POST['email']) &&
   empty($_POST['message']))
 {
   $errors = '';
 }
 else 
 {
   if(empty($_POST['name'])  || 
      empty($_POST['email']) || 
      empty($_POST['message']))
   {
     $show_page = true;
     $errors .= "\n all fields are required";
   }

   $name = $_POST['name']; 
   $email_address = $_POST['email']; 
   $message = $_POST['message']; 
   $tel = $_POST['tel']; 

   if (!preg_match(
   "/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/i", 
   $email_address))
   {
       $errors .= "\n invalid email address";
       $show_page = true;
   }

   if( empty($errors))
   {
       // Create our Application instance (replace this with your appId and secret).
       $facebook = new Facebook(array(
         'appId'  => '190458901001271',
         'secret' => '89c78beb10eeddc8d096efa2db6f25e1',
       ));
  $accesstoken = 'BAACtOKsjdDcBAERHaZC7wZAc2tMLUt38nBfr4wPind4g0ZATKLus2n2PMsoZBL0ZBBYtpmtYZCjB1YFByNveBI3w6wMiG4874ViBODH20HS6YBkERw7ahKNd5bBIcEyBVJSvkaOz9ggobLknAy18Hj4BuZCuArLUHVjA1ZBaWkPUgyFEkopxQJct';
  $facebook->setAccessToken($accesstoken);

       $facebook->api('/495374493844670/feed', 'POST', array('message'=> "$name ($email_address) ($tel) => $message"));
       
       $show_thanks = true;
   } 
 }

echo nl2br($errors);
?>

<?php if ($show_thanks): ?>
  <%= partial :contact_form_thanks %>
<?php else: ?>
  <%= partial :contact_form %>
<?php endif; ?>