/*
 * jquery.youtube.js v0.1a1 - a jquery youtube player
 * Copyright (c) 2010 Richard Willis
 * MIT license	: http://www.opensource.org/licenses/mit-license.php
 * Project	: http://github.com/badsyntax/jquery-youtube-player
 * Contact	: willis.rh@gmail.com | badsyntax.co.uk
 */
(function(e,t,n,r){function i(r,i,s){var o=this;this._pluginName=s,this.element=e(r).addClass("ui-widget"),this.options=e.extend({width:425,height:356,swfobject:t.swfobject,playlist:{},showPlaylist:1,showTime:1,videoThumbs:0,randomStart:0,autoStart:0,autoPlay:0,repeat:1,repeatPlaylist:0,shuffle:0,chromeless:1,highDef:0,playlistHeight:5,playlistBuilder:null,playlistBuilderClickHandler:null,playlistAnimation:{height:"show",opacity:"show"},playlistSpeed:550,toolbarAppendTo:null,playlistAppendTo:null,timeAppendTo:null,videoParams:{allowfullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},showToolbar:null,toolbarButtons:{},toolbar:"play,prev,next,shuffle,repeat,mute,playlistToggle",toolbarAnimation:{opacity:1},toolbarSpeed:500},i),!this.options.chromeless&&this.options.showToolbar!=1&&(this.options.showToolbar=0),this._states={unstarted:-1,ended:0,play:1,paused:2,buffering:3,cued:5},this._youtubeIdExp=/^[^v]+v.(.{11}).*/,this.buttons=e.extend({},this.defaultToolbarButtons,this.options.toolbarButtons);if(this.element.is("a")){var u=this.element;this.element=e('<div class="youtube-player"></div>');var a=e('<div class="youtube-player-video"></div>').appendTo(this.element),f=e('<div class="youtube-player-object"></div>').appendTo(a),l=e('<ol class="youtube-player-playlist"><li></li></ol>').find("li").append(u.clone()).end().appendTo(this.element);u.after(this.element).hide()}this.elements={player:this.element,playerVideo:this.element.find(".youtube-player-video"),playerObject:this.element.find(".youtube-player-object")},this.elements.playerObjectClone=this.elements.playerObject.clone(),this.keys={video:0};var c;do c="jqueryyoutubeplayer"+Math.floor(Math.random()*101).toString();while(n.getElementById(c));this.elements.playerObject[0].id=c,this.options.swfobject.getFlashPlayerVersion().major>=8&&this.loadPlaylist(null,null,null,function(){o._bindYoutubeEventHandlers()._createToolbar()._createTimeArea()._createPlayer()})}e.fn.player=function(t){var n="jquery-youtube-player",s=arguments,o=r;return this.each(function(){var u=e.data(this,n);u&&u[t]?(o=u[t].apply(u,Array.prototype.slice.call(s,1)),o=t=="plugin"?o:r):!u&&(typeof t=="object"||!t)&&e.data(this,n,new i(this,t,n))}),o||this},i.prototype={_activeStates:[],timer:{},videoIds:[],_trigger:function(t,n,r){var i=typeof n;r=r||[];if(i==="string"&&this.options[n]&&e.isFunction(this.options[n]))return this.options[n].apply(t,r);i==="function"&&n.apply(t,r)},_bindYoutubeEventHandlers:function(){function i(t){e.youtubePlayer=n.getElementById(t),e._trigger(e,"onPlayerReady",[t]),e.loadVideo(!1,!0),e.elements.toolbar.container.animate(e.options.toolbarAnimation,e.options.toolbarSpeed,function(){e._trigger(e,"onReady",[t])}),e._showPlaylist(function(){e.keys.play&&e.playVideo()})}function s(){e._trigger(this,"onVideoPaused",[e._getVideo()])}function o(){e.buttons.play.element&&e.buttons.play.element.trigger("off"),e.options.repeat&&e.nextVideo()}function u(t){switch(t){case 100:msg="This video has been removed from Youtube.";break;case 101:case 150:msg="This video does not allow playback outside of Youtube.";break;default:msg="Unknown error"}e._trigger(this,"onError",[msg])===r&&alert("There was an error loading this video. "+msg)}function a(){e._updatePlaylist(),e.elements.toolbar.updateStates(),e._trigger(this,"onVideoCue",arguments)}function f(){e._trigger(this,"onBuffer",[e._getVideo()])}function l(){e._updatePlaylist(),e._addState("play"),e.elements.toolbar.updateStates(),e._updateTime(),e._trigger(this,"onVideoPlay",[e._getVideo()])}var e=this,c=this.elements.playerObject[0].id;return t["onytplayerStateChange"+c]=function(t){e._removeStates([-1,0,1,2,3,5,100,101,150,9]),e._addState(t,!0);switch(t){case 0:o();break;case 1:l();break;case 2:s();break;case 3:f();break;case 9:i(c);break;case 5:a();break;case 100:case 101:case 150:u(t)}e._trigger(e,"onYoutubeStateChange",[t])},t.onYouTubePlayerReady||(t.onYouTubePlayerReady=function(e){var r=n.getElementById(e);r.addEventListener("onStateChange","onytplayerStateChange"+e),r.addEventListener("onError","onytplayerStateChange"+e),t["onytplayerStateChange"+e](9)}),this},_createPlayer:function(){this.elements.player.width(this.options.width),this.elements.playerVideo.height(this.options.height);var e=this.options.playlist.videos[this.keys.video].id,t=this.elements.playerObject[0].id,n=this.options.chromeless?"http://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid="+t+"&hd="+this.options.highDef+"&showinfo=0":"http://www.youtube.com/v/"+e+"?enablejsapi=1&playerapiid="+t+"&version=3";return this._trigger(this,"onBeforePlayerBuild"),this.options.swfobject.embedSWF(n,this.elements.playerObject[0].id,"100%","100%","8",null,null,this.options.videoParams),this},_createToolbar:function(){var t=this;return this.elements.toolbar={container:e("<ul />").addClass("youtube-player-toolbar ui-widget ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").css("opacity",0),updateStates:function(){t.elements.toolbar.container.find("li").each(function(){var n=e(this).removeClass("ui-state-active").data("button");if(!n)return!0;t._state(n.val)&&n.toggle&&e(this).addClass("ui-state-active"),t._state(n.val)&&n.toggleButton&&e(this).trigger("on")})}},this.options.showToolbar!=null&&!this.options.showToolbar&&this.elements.toolbar.container.hide(),e.each(this.options.toolbar.split(","),function(n,i){var s=t.buttons[i];if(!s||!s.text)return!0;s.val=i,t._states[i]=t._states[i]||i,e("<li></li>").addClass("ui-state-default ui-corner-all").append('<span class="ui-icon '+s.icon+'"></span>').attr("title",s.text).data("button",s).bind("mouseenter mouseleave",function(){e(this).toggleClass("ui-state-hover")}).bind("off",function(){var n=e(this),r=n.data("button"),s=1;n.data("toggle",s),t._removeState(i),n.find(".ui-icon").removeClass(r.toggleButton.icon).addClass(r.icon).end().attr("title",r.text),t._trigger(t,r.toggleButton.action,[r])}).bind("on",function(){var n=e(this),r=n.data("button"),s=0;n.data("toggle",s),t._addState(i),n.find(".ui-icon").removeClass(r.icon).addClass(r.toggleButton.icon).end().attr("title",r.toggleButton.text),t._trigger(t,r.action,[r])}).bind("toggle",function(){var t=e(this).data("toggle");t||t==r?e(this).trigger("on"):e(this).trigger("off")}).click(function(){var n=e(this).data("button"),r=t._state(i);n.toggleButton?e(this).trigger("toggle"):(t._trigger(t,n.action,[n]),!n.toggle||n.toggle&&r?t._removeState(i):t._addState(i),t.elements.toolbar.updateStates())}).appendTo(t.elements.toolbar.container)}),this.options.toolbarAppendTo?this.elements.toolbar.container.appendTo(this.options.toolbarAppendTo):this.elements.playerVideo.after(this.elements.toolbar.container),this},_createTimeArea:function(){return this.elements.toolbar.time=this.options.timeAppendTo?e("<span />").appendTo(this.options.timeAppendTo):e("<li />").addClass("youtube-player-time").appendTo(this.elements.toolbar.container),this.elements.toolbar.timeCurrent=e("<span />").html("0:00").appendTo(this.elements.toolbar.time),this.elements.toolbar.timeDuration=e("<span />").appendTo(this.elements.toolbar.time),this},_createPlaylist:function(){function n(){var n=e(this).data("video");if(!n)return;t.keys.video=e.inArray(n.id,t.videoIds),t._removeState("play"),t._updatePlaylist(),t.loadVideo(),t.playVideo()}function r(){t.elements.playlist=t.elements.playlist||e("<ol />").addClass("youtube-player-playlist ui-helper-reset"),t.elements.playlistContainer=t.elements.playlistContainer||e("<div />").addClass("youtube-player-playlist-container ui-widget-content ui-corner-all").html(t.elements.playlist)}var t=this;this._addVideosToPlaylist=function(n){var r=n?[t.options.playlist.videos[t.options.playlist.videos.length-1]]:t.options.playlist.videos;n||(t.elements.playlist.empty(),t.videoIds=[]),e.each(r,function(){t.videoIds.push(this.id),e("<li />").data("video",this).append(t.options.videoThumbs?'<img alt="'+this.title+'" title="'+this.title+'" src="http://img.youtube.com/vi/'+this.id+'/2.jpg" />':this.title).addClass("ui-state-default").addClass(t.options.videoThumbs?"youtube-player-thumb":"").bind("mouseenter mouseleave",function(){e(this).toggleClass("ui-state-hover")}).appendTo(t.elements.playlist)}),t._trigger(t,"onAfterVideosAddedToPlaylist")},this._bindPlaylistClickHandler=function(e){e.items.click(function(){t._trigger(this,n,arguments),t._trigger(t,"playlistBuilderClickHandler",arguments)})};var i;e.isFunction(this.options.playlistBuilder)?i=this.options.playlistBuilder:(r(),this._addVideosToPlaylist(),this.options.playlistAppendTo?this.elements.playlistContainer.appendTo(this.options.playlistAppendTo):this.elements.toolbar.container.after(this.elements.playlistContainer),i=function(){return{items:t.elements.playlist.find("li"),container:t.elements.playlistContainer}}),e.each(this.options.playlist.videos,function(){t.videoIds.push(this.id)});var s=i.call(this,this.options.playlist.videos);return this.elements.playlistContainer=s.container,this._bindPlaylistClickHandler(s),this},_updateTime:function(){function n(e){var t=Math.floor(e/60),n=(e%60).toFixed(0);return t+":"+(n<10?"0"+n:n)}if(!this.options.showTime)return;var e=this,t=Number(this.youtubePlayer.getDuration());this.elements.toolbar.timeDuration.html(" / "+n(t)),this.elements.toolbar.time.fadeIn(),this.timeInterval=setInterval(function(){e.youtubePlayer.getCurrentTime?e.elements.toolbar.timeCurrent.html(n(e.youtubePlayer.getCurrentTime())):clearInterval(e.timeInterval)},100)},_removeStates:function(t){var n=[];e.each(this._activeStates,function(r,i){e.inArray(i,t)===-1&&e.inArray(i,n)===-1&&n.push(i)}),this._activeStates=n},_removeState:function(e){e=typeof e=="string"?this._states[e]:e,this._removeStates([e])},_state:function(t,n){return t=this._states[t],e.inArray(t,this._activeStates)!==-1?!0:!1},_addState:function(t,n){n?e.inArray(t,this._activeStates)===-1&&this._activeStates.push(t):this._states[t]&&e.inArray(this._states[t],this._activeStates)===-1&&this._activeStates.push(this._states[t])},_setVideoKey:function(e){this.keys.video=this.options.shuffle?this.options.randomVideo():e||0},_getVideo:function(){return this.options.playlist.videos[this.keys.video]},_findVideo:function(t){var n=-1;return e.each(this.options.playlist.videos,function(e,r){if(t==r.id)return n=e,!1}),n},_getPlaylistData:function(t,n){var r=this,i=this.options.playlist;if(i.user||i.playlist){function s(s){if(!s){n.call(r);return}r.options.playlist={title:s.feed.title.$t,id:i,videos:[]},e.each(s.feed.entry,function(e,t){r.options.playlist.videos.push({id:t.link[0].href.replace(r._youtubeIdExp,"$1"),title:t.title.$t})}),r.elements.playerObject.fadeOut(180,function(){t.call(r)})}var o=i.user?"http://gdata.youtube.com/feeds/api/videos":"http://gdata.youtube.com/feeds/api/playlists/"+i.playlist;o+="?callback=?";var u={alt:"json",format:"5"};i.user&&(u.author=i.user),this._trigger(this,"onBeforePlaylistLoaded",[i]),e.ajax({type:"GET",url:o,data:u,dataType:"json",error:function(){r._trigger(r,"onAfterPlaylistLoaded",[i]),r._trigger(r,n)},success:function(){r._trigger(r,"onAfterPlaylistLoaded",[i]),r._trigger(r,s,arguments)}});return}if(!i.videos){var a=this.elements.player.find(".youtube-player-playlist li a");a.length&&(r.options.playlist.videos=[],a.each(function(){r.options.playlist.videos.push({id:this.href.replace(r._youtubeIdExp,"$1"),title:e(this).html(),element:this})}))}r._trigger(r,"onAfterPlaylistLoaded",[i]),r._trigger(r,t)},_updatePlaylist:function(){var t=this;this.elements.playlist&&this.elements.playlist.find("li").removeClass("ui-state-active").each(function(n){if(t.options.playlist.videos[t.keys.video].id==e(this).data("video").id){var r=e(this).addClass("ui-state-active").outerHeight();if(!t.options.videoThumbs){var i=n*r-Math.floor(t.options.playlistHeight/2)*r;t.elements.playlist.scrollTop(i)}return!1}})},_showPlaylist:function(e){var t=this.options.showPlaylist;t&&this.elements.playlistContainer.show();var n=this.elements.playlist.height(),r=this.elements.playlist.css("height","auto").height(),i=this.elements.playlist.find("li:first").outerHeight(),s=i*this.options.playlistHeight,o=s<r?s:r;t&&this.elements.playlistContainer.hide(),this.elements.playlist.children().length?o&&(this.elements.playlist.height(o),this.options.showPlaylist||t?this.elements.playlistContainer.animate(this.options.playlistAnimation,this.options.playlistSpeed,e):this._trigger(this,e)):(this.elements.playlistContainer.hide(),this._trigger(this,e))},loadVideo:function(e,t){function r(e){t?n.cueVideo(e):n.youtubePlayer.loadVideoById(e,0),n._trigger(n,"onVideoLoad",[n._getVideo()])}var n=this;if(e&&e.id)e={id:e.id,title:e.title},this.videoIds=t?this.videoIds:[],t?this.options.playlist.videos.push(e):this.options.playlist.videos=e.title?[e]:[],this._addVideosToPlaylist(t),!t&&r(e.id);else if(e){var i=this._findVideo(e);i!==-1&&(this.keys.video=i,r(e))}else r(this.options.playlist.videos[this.keys.video].id)},loadPlaylist:function(e,t,n,i){n=n===r?!0:n,e&&(this.options.playlist=e),this._getPlaylistData(function(){this.keys.video=this.options.randomStart?this.randomVideo():0,this._trigger(this,i),this._createPlaylist(),n&&this._showPlaylist()},function(){var e="There was an error loading the playlist.";this.elements.playerObject.html(e),this._trigger(this,"onError",[e])})},pauseVideo:function(){this.youtubePlayer.pauseVideo()},shufflePlaylist:function(){this.randomVideo(),this.playVideo()},muteVideo:function(e){this._state("mute")?this.youtubePlayer.unMute():this.youtubePlayer.mute()},repeat:function(){this.options.repeat=1},playVideo:function(){this.youtubePlayer.playVideo()},cueVideo:function(e,t){return this.youtubePlayer.cueVideoById(e||this.options.playlist.videos[this.keys.video].id,t||0)},randomVideo:function(){return this.keys.video=Math.floor(Math.random()*this.options.playlist.videos.length),this.keys.video},prevVideo:function(){if(this.keys.video>0)this._setVideoKey(--this.keys.video);else{if(!this.options.repeatPlaylist)return;this._setVideoKey(this.videoIds.length-1)}this.loadVideo(null,this._state("play")||this.options.autoPlay?!1:!0)},nextVideo:function(){if(this.keys.video<this.options.playlist.videos.length-1)this._setVideoKey(++this.keys.video);else{if(!this.options.repeatPlaylist)return;this._trigger(this,"onEndPlaylist"),this._setVideoKey(0)}this.loadVideo(null,this._state("play")||this.options.autoPlay?!1:!0)},playlistToggle:function(e){this.elements.playlistContainer.find("li").length&&this.elements.playlistContainer.animate({height:"toggle",opacity:"toggle"},this.options.playlistSpeed)},plugin:function(){return this},state:function(){var t=this,n=[];return e.each(this._activeStates,function(r,i){e.each(t._states,function(e,t){i===t&&n.push(e)})}),n},videos:function(){return this.options.playlist.videos},videoIndex:function(){return this.keys.video},destroy:function(){clearInterval(this.timeInterval),this.element.removeClass("ui-widget").removeAttr("style"),this.elements.playerVideo.removeAttr("style"),this.elements.playlistContainer.remove(),this.elements.toolbar.container.remove(),this.options.swfobject.removeSWF(this.elements.playerObject[0].id),this.elements.playerObjectClone.appendTo(this.elements.playerVideo),e.removeData(this.element[0],this._pluginName)}},i.prototype.defaultToolbarButtons={play:{text:"Play",icon:"ui-icon-play",toggleButton:{text:"Pause",icon:"ui-icon-pause",action:function(){this.pauseVideo()}},action:function(){this.playVideo()}},prev:{text:"Prev",icon:"ui-icon-seek-prev",action:function(){this.prevVideo()}},next:{text:"Next",icon:"ui-icon-seek-next",action:function(){this.nextVideo()}},shuffle:{text:"Shuffle/Random",icon:"ui-icon-shuffle",toggle:1,action:function(){this.shufflePlaylist()}},repeat:{text:"Repeat playlist",icon:"ui-icon-refresh",toggle:1,action:function(){this.repeat()}},mute:{text:"Mute",icon:"ui-icon-volume-on",toggle:1,action:function(e){this.muteVideo(e)}},playlistToggle:{text:"Toggle playlist",icon:"ui-icon-script",action:function(){this.playlistToggle()}}}})(this.jQuery,this,document);